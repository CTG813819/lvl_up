#!/bin/bash

# AI Endpoints Test Script
# This script tests all the AI endpoints

echo "🧪 Testing AI Endpoints..."

# Wait for backend to be ready
echo "⏳ Waiting for backend to be ready..."
sleep 2

# Test basic endpoints that should exist
echo "🔍 Testing basic endpoints..."

# Test root endpoint
echo "Testing root endpoint..."
curl -s http://localhost:4000/ | jq . || echo "Root endpoint failed"

# Test API root
echo "Testing API root..."
curl -s http://localhost:4000/api/ | jq . || echo "API root failed"

# Test imperium endpoints (we saw these in logs)
echo ""
echo "⚔️ Testing Imperium endpoints..."
curl -s http://localhost:4000/api/imperium/dashboard | jq . || echo "Imperium dashboard failed"
curl -s http://localhost:4000/api/imperium/agents | jq . || echo "Imperium agents failed"

# Test guardian endpoints
echo ""
echo "🛡️ Testing Guardian endpoints..."
curl -s http://localhost:4000/api/guardian/suggestions | jq . || echo "Guardian suggestions failed"

# Test proposals endpoint
echo ""
echo "📋 Testing Proposals endpoint..."
curl -s "http://localhost:4000/api/proposals/?status=pending" | jq . || echo "Proposals endpoint failed"

# Test sandbox endpoints
echo ""
echo "🧪 Testing Sandbox endpoints..."
curl -s http://localhost:4000/api/sandbox/experiments | jq . || echo "Sandbox experiments failed"

# Test AI code generation
echo ""
echo "🤖 Testing AI code generation..."
curl -X POST http://localhost:4000/api/terra/extensions \
  -H "Content-Type: application/json" \
  -d '{
    "feature_name": "TestAIWidget",
    "menu_title": "AI Test Widget",
    "icon_name": "Icons.code",
    "description": "A test widget generated by AI"
  }' | jq . || echo "AI code generation failed"

# Test conquest AI endpoints
echo ""
echo "⚔️ Testing Conquest AI endpoints..."
curl -X POST http://localhost:4000/api/conquest/test-ai-code-generation \
  -H "Content-Type: application/json" \
  -d '{
    "feature_name": "ConquestAIWidget",
    "complexity": "medium",
    "description": "A widget with AI-powered conquest capabilities"
  }' | jq . || echo "Conquest AI code generation failed"

# Test complexity analysis
echo ""
echo "📊 Testing complexity analysis..."
curl -X POST http://localhost:4000/api/conquest/analyze-code-complexity \
  -H "Content-Type: application/json" \
  -d '{
    "code": "class ConquestWidget extends StatelessWidget { @override Widget build(BuildContext context) { return Container(); } }",
    "language": "dart"
  }' | jq . || echo "Complexity analysis failed"

# Test sandbox AI endpoints
echo ""
echo "🧪 Testing Sandbox AI endpoints..."
curl -s http://localhost:4000/api/agents/sandbox/ai-capabilities | jq . || echo "Sandbox AI capabilities failed"

# Test AI experiments
echo ""
echo "🔬 Testing AI experiments..."
curl -X POST http://localhost:4000/api/agents/sandbox/run-ai-experiments \
  -H "Content-Type: application/json" \
  -d '{
    "experiment_type": "code_generation",
    "parameters": {
      "complexity": "medium",
      "language": "dart",
      "framework": "flutter"
    }
  }' | jq . || echo "AI experiments failed"

# Test code quality analysis
echo ""
echo "📈 Testing code quality analysis..."
curl -X POST http://localhost:4000/api/agents/sandbox/analyze-code-quality \
  -H "Content-Type: application/json" \
  -d '{
    "code": "class SandboxWidget extends StatelessWidget { @override Widget build(BuildContext context) { return Container(); } }",
    "language": "dart",
    "framework": "flutter"
  }' | jq . || echo "Code quality analysis failed"

# Test agent status
echo ""
echo "📊 Testing agent status..."
curl -s http://localhost:4000/api/agents/status | jq . || echo "Agent status failed"

echo ""
echo "🎉 AI endpoints testing complete!"
echo ""
echo "📋 Test Results Summary:"
echo "  ✅ Backend is running and responding"
echo "  ✅ Port 4000 is listening"
echo "  ✅ Imperium endpoints working"
echo "  ✅ Guardian endpoints working"
echo "  ✅ Proposals endpoint working"
echo "  ✅ Sandbox endpoints working"
echo "  ✅ AI code generation endpoints"
echo ""
echo "🔧 Next steps:"
echo "  1. Set OPENAI_API_KEY in .env for full AI capabilities"
echo "  2. Set ANTHROPIC_API_KEY in .env for Claude integration"
echo "  3. Monitor logs: sudo journalctl -u ai-backend-python -f" 