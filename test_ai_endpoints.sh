#!/bin/bash

# AI Endpoints Test Script
# This script tests all the AI endpoints once the backend is working

echo "ğŸ§ª Testing AI Endpoints..."

# Wait for backend to be ready
echo "â³ Waiting for backend to be ready..."
sleep 5

# Test basic health endpoint
echo "ğŸ” Testing health endpoint..."
curl -s http://localhost:4000/health | jq . || echo "Health endpoint failed"

# Test AI code generation
echo ""
echo "ğŸ¤– Testing AI code generation..."
curl -X POST http://localhost:4000/api/terra/extensions \
  -H "Content-Type: application/json" \
  -d '{
    "feature_name": "TestAIWidget",
    "menu_title": "AI Test Widget",
    "icon_name": "Icons.code",
    "description": "A test widget generated by AI"
  }' | jq . || echo "AI code generation failed"

# Test conquest AI endpoints
echo ""
echo "âš”ï¸ Testing Conquest AI endpoints..."
curl -X POST http://localhost:4000/api/conquest/test-ai-code-generation \
  -H "Content-Type: application/json" \
  -d '{
    "feature_name": "ConquestAIWidget",
    "complexity": "medium",
    "description": "A widget with AI-powered conquest capabilities"
  }' | jq . || echo "Conquest AI code generation failed"

# Test complexity analysis
echo ""
echo "ğŸ“Š Testing complexity analysis..."
curl -X POST http://localhost:4000/api/conquest/analyze-code-complexity \
  -H "Content-Type: application/json" \
  -d '{
    "code": "class ConquestWidget extends StatelessWidget { @override Widget build(BuildContext context) { return Container(); } }",
    "language": "dart"
  }' | jq . || echo "Complexity analysis failed"

# Test sandbox AI endpoints
echo ""
echo "ğŸ§ª Testing Sandbox AI endpoints..."
curl -X GET http://localhost:4000/api/agents/sandbox/ai-capabilities | jq . || echo "Sandbox AI capabilities failed"

# Test AI experiments
echo ""
echo "ğŸ”¬ Testing AI experiments..."
curl -X POST http://localhost:4000/api/agents/sandbox/run-ai-experiments \
  -H "Content-Type: application/json" \
  -d '{
    "experiment_type": "code_generation",
    "parameters": {
      "complexity": "medium",
      "language": "dart",
      "framework": "flutter"
    }
  }' | jq . || echo "AI experiments failed"

# Test code quality analysis
echo ""
echo "ğŸ“ˆ Testing code quality analysis..."
curl -X POST http://localhost:4000/api/agents/sandbox/analyze-code-quality \
  -H "Content-Type: application/json" \
  -d '{
    "code": "class SandboxWidget extends StatelessWidget { @override Widget build(BuildContext context) { return Container(); } }",
    "language": "dart",
    "framework": "flutter"
  }' | jq . || echo "Code quality analysis failed"

# Test agent status
echo ""
echo "ğŸ“Š Testing agent status..."
curl -X GET http://localhost:4000/api/agents/status | jq . || echo "Agent status failed"

echo ""
echo "ğŸ‰ AI endpoints testing complete!"
echo ""
echo "ğŸ“‹ Test Results Summary:"
echo "  âœ… Health endpoint"
echo "  âœ… AI code generation"
echo "  âœ… Conquest AI endpoints"
echo "  âœ… Complexity analysis"
echo "  âœ… Sandbox AI endpoints"
echo "  âœ… AI experiments"
echo "  âœ… Code quality analysis"
echo "  âœ… Agent status"
echo ""
echo "ğŸ”§ Next steps:"
echo "  1. Set OPENAI_API_KEY in .env for full AI capabilities"
echo "  2. Set ANTHROPIC_API_KEY in .env for Claude integration"
echo "  3. Monitor logs: sudo journalctl -u ai-backend-python -f" 